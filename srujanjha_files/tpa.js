define("tpa/mixins/tpaCompBaseMixin",["zepto","lodash"],function(a,b){"use strict";var c={mobile:"unavailableInMobile",https:"unavailableInHttps"},d=function(c){var d=c.getDOMNode(),e=a(d).offset();return b.extend({scrollTop:document.body.scrollTop,scrollLeft:document.body.scrollLeft,documentHeight:a(document.body).height(),documentWidth:a(document.body).width(),x:e.left,y:e.top},d.getBoundingClientRect())};return{ALIVE_TIMEOUT:2e4,onScroll:function(){var a=d(this);this.sendPostMessage({intent:"addEventListener",eventType:"SCROLL",params:a})},isUnderMobileView:function(){return this.props.siteData.isMobileView()},isInMobileDevMode:function(){var a=this.isUnderMobileView(),c=this.props.siteData.currentUrl.query.appDefinitionId,d=this.getAppData();return a&&c&&b.contains(c,d.appDefinitionId)},getEcomParams:function(){var a=this.getAppData();return"1380b703-ce81-ff05-f115-39571d94dfcd"===a.appDefinitionId&&this.props.siteData.currentUrl.query["ecom-tpa-params"]},_createOverlayChildComponent:function(a,c,d){return d=d||{},this.createChildComponent(b.merge(d,{id:c,style:this.props.style,overlay:this.state.overlay,applicationId:this.props.compData.applicationId,hideOverlayFunc:this._hideOverlay}),a,c)},_hideOverlay:function(){this.setState({showOverlay:!1})},_createOverlay:function(a){if(!a)return null;switch(a){case"preloader":return this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAPreloaderOverlay","preloaderOverlay");case"unresponsive":return this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay","unavailableMessageOverlay",{text:"We're sorry, this content cannot be displayed. Please try again later."});case c.https:return this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay","unavailableMessageOverlay",{text:"We're sorry, this content cannot be displayed."});case c.mobile:return this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay","unavailableMessageOverlay",{text:"We're sorry, this content is currently not optimized for mobile view."});default:return null}},addAttributesForLayout:function(){return this.state&&this.state.height?{"data-min-height":this.state.height}:{}},getRootStyle:function(){var a=b.omit(this.props.style,"height");return this.state&&this.state.height&&(a.height=this.state.height),"masterPage"===this.props.pageId&&(a.zIndex="100"),a},shouldRenderIframe:function(){var a=this.state.overlay,d=!b.contains(c,a);return this._shouldClientSpecMapBeReloaded()?d&&!!this.props.siteData.dynamicModelState:d},_getIframeProperties:function(){if(!this.shouldRenderIframe())return null;var a=this._shouldShowIframe(this.state),b=this.buildUrl(this.getBaseUrl());return{src:b,key:b,scrolling:"no",frameBorder:"0",allowTransparency:!0,allowFullScreen:!0,style:{display:a?"block":"none",width:"100%",height:"100%",overflow:"hidden",position:"absolute"}}},getSkinProperties:function(){var a=this._createOverlay(this.state.overlay),c=this._getIframeProperties(),d={"":{style:this.getRootStyle()},overlay:this.state.showOverlay?a:null,iframe:c?c:"remove"};return b.assign(d[""],this.addAttributesForLayout()),this.checkIfNeedToSendMemberData(),this.mutateSkinProperties&&(d=this.mutateSkinProperties(d)),d},checkIfNeedToSendMemberData:function(){var a=this.state.shouldGetSiteMemberDetails;if(a){var b=this.props.siteAPI.getSiteAspect("siteMembers"),c=b.getMemberDetails();c&&a.callback({authResponse:!0,data:c})}},getInitialState:function(){var a=this.getBaseUrl(),b={overlay:this._getInitialOverlay(a,this.props.siteData.currentUrl.protocol),isAlive:!1,registeredEvents:[],showOverlay:!0};return this.mutateInitialState&&(b=this.mutateInitialState(b)),b},_shouldShowIframe:function(a){var b=!0;return this._shouldClientSpecMapBeReloaded()&&(b=this._isClientSpecMapReloaded()),b&&(!a.overlay||"preloader"===a.overlay)},_isClientSpecMapReloaded:function(){return"success"===this.props.siteData.dynamicModelState},_shouldClientSpecMapBeReloaded:function(){return this.props.siteData.isViewerMode()},_getInitialOverlay:function(a,b){if(this.isMobileReady&&this.isUnderMobileView()&&!this.isMobileReady())return c.mobile;var d=this._isUrlSecure(a),e=this._isUrlSecure(b),f=e&&!d;return f?c.https:"preloader"},componentDidMount:function(){var a=this.state.overlay;this.state.isAlive||b.contains(c,a)||(this._appAliveTimeout=setTimeout(this._onAppAliveTimeoutExpires,this.ALIVE_TIMEOUT))},_onAppAliveTimeoutExpires:function(){this.showUnresponsiveOverlay()},showUnresponsiveOverlay:function(){this.state.isAlive||this.setState({overlay:"unresponsive"})},componentWillUnmount:function(){this._clearAliveTimeout()},_clearAliveTimeout:function(){this._appAliveTimeout&&clearTimeout(this._appAliveTimeout)},setAppIsAlive:function(a){this._clearAliveTimeout(),this.setState({isAlive:!0,overlay:"preloader"===this.state.overlay?null:this.state.overlay},a)},_isUrlSecure:function(a){return/^https/.test(a)}}}),define("tpa/utils/tpaUtils",["lodash"],function(a){"use strict";var c,b="TPA_PUB_SUB_",d=function(){return a.isUndefined(c)&&(c=a.now()+""),c},e=function(a,b){var c=a.getComponentById(b),d=a.getSiteData().getClientSpecMapEntry(c.props.compData.applicationId);return d},f=function(a){return a.getSiteData().getClientSpecMap()},g=function(a,b){var c=e(a,b);return c.appDefinitionId},h=function(a){var c=new RegExp("^"+b);return a.replace(c,"")},i=function(a){return b.concat(a)},j=function(a){return a&&"wysiwyg.viewer.components.tpapps.TPASection"===a.props.structure.componentType},k=function(b,c){b=b||"0.0.0",c=c||"1.41.0";var d=a.map(b.split("."),function(a){return parseInt(a)}),e=a.map(c.split("."),function(a){return parseInt(a)});return 3===d.length&&3===e.length?d[0]>=e[0]&&d[1]>=e[1]&&d[2]>=e[2]:!1},l=function(b){var c=b.cookieUtils.getCookie("_wixUIDX")||"";return c=c.slice(a.lastIndexOf(c,"|")+1),c=c.replace(/^(null-user-id|null)$/g,"")},m=function(a,b){var c=f(a),d=c[b]&&c[b].instance.split(".")[1];return d&&JSON.parse(atob(d))};return{Constants:{TPA_PUB_SUB_PREFIX:b},getCacheKiller:d,getAppData:e,getAppDefId:g,stripPubSubPrefix:h,addPubSubEventPrefix:i,isTPASection:j,sdkVersionIsAtLeast:k,getVisitorUuid:l,getInstance:m,getClientSpecMap:f}}),define("tpa/common/TPAUrlBuilder",["lodash","utils"],function(a,b){"use strict";var c=function(a){this.url=b.urlUtils.parseUrl(a),this.url.query=this.url.query||{},this.url.search=null};return c.prototype={addCacheKiller:function(b){return b&&!a.isEmpty(b)&&(this.url.query.cacheKiller=b),this},addInstance:function(b){return b&&!a.isEmpty(b)&&(this.url.query.instance=b),this},addWidth:function(b){return b&&!a.isEmpty(b)&&(this.url.query.width=b),this},addLocale:function(b){return b&&!a.isEmpty(b)&&(this.url.query.locale=b),this},addViewMode:function(b){return b&&!a.isEmpty(b)&&(this.url.query.viewMode=b),this},addCompId:function(b){return b&&!a.isEmpty(b)&&(this.url.query.compId=b),this},addDeviceType:function(b){return b&&!a.isEmpty(b)&&(this.url.query.deviceType=b),this},addArbitraryQueryParams:function(b){return b&&!a.isEmpty(b)&&a.assign(this.url.query,b),this},addEndpointType:function(b){return b&&!a.isEmpty(b)&&(this.url.query.endpointType=b),this},addOrigCompId:function(b){return b&&!a.isEmpty(b)&&(this.url.query.origCompId=b),this},mutateIframeSrc:function(a){return a&&(this.url=a(this.url)),this},filterQueryParams:function(b){return b&&!a.isEmpty(b)&&(this.url.query=a.pick(this.url.query,b)),this},build:function(){return b.urlUtils.buildFullUrl(this.url)}},c}),define("tpa/mixins/tpaUrlBuilderMixin",["lodash","utils","tpa/utils/tpaUtils","tpa/common/TPAUrlBuilder"],function(a,b,c,d){"use strict";var e=function(a,b){return a.mutateIframeUrlQueryParam&&(b=a.mutateIframeUrlQueryParam(b)),b};return{buildUrl:function(b,f){var g=this.state.queryParams||{};g=a.merge(g,e(this,g)),this.getEcomParams&&this.getEcomParams()&&(g["ecom-tpa-params"]=this.getEcomParams());var h=new d(b).addCompId(this.props.id).addDeviceType(this.getDeviceType(this)).addInstance(this.getAppData(this).instance).addLocale(this.props.siteData.rendererModel.languageCode).addViewMode(this.getViewMode(this)).addCacheKiller(c.getCacheKiller()).filterQueryParams(f).addArbitraryQueryParams(g);return this.mutateIframeSrc&&h.mutateIframeSrc(this.mutateIframeSrc),h.build()}}}),define("tpa/mixins/tpaCompApiMixin",["lodash"],function(a){"use strict";return{SUPPORTED_SITE_EVENTS:{SCROLL:"SCROLL",PAGE_NAVIGATION:"PAGE_NAVIGATION",PAGE_NAVIGATION_IN:"PAGE_NAVIGATION_IN",PAGE_NAVIGATION_OUT:"PAGE_NAVIGATION_OUT",PAGE_NAVIGATION_CHANGE:"PAGE_NAVIGATION_CHANGE",STATE_CHANGED:"STATE_CHANGED"},isEventSupported:function(a){return!!this.SUPPORTED_SITE_EVENTS[a]},isCompListensTo:function(b){return a.contains(this.state.registeredEvents,b)},getAppData:function(){return this.props.siteData.rendererModel.clientSpecMap[this.props.compData.applicationId]||{}},getDeviceType:function(){return this.props.siteData.isMobileView()?"mobile":"desktop"},getViewMode:function(){return this.props.siteData.viewMode},sendPostMessage:function(a){this.props.siteAPI.getSiteAspect("tpaPostMessageAspect").sendPostMessage(this,a)},getIframe:function(){return this.refs.iframe&&this.refs.iframe.getDOMNode()},startListen:function(b){this.isEventSupported(b)&&(this.setState({registeredEvents:this.state.registeredEvents.concat(b)}),this.props&&b===this.SUPPORTED_SITE_EVENTS.SCROLL&&this.props.siteAPI.getSiteAspect("windowScrollEvent").registerToScroll(this),(this.props&&a.contains(b,this.SUPPORTED_SITE_EVENTS.PAGE_NAVIGATION)||this.props&&a.contains(b,this.SUPPORTED_SITE_EVENTS.PAGE_NAVIGATION_CHANGE))&&this.props.siteAPI.getSiteAspect("tpaPageNavigationAspect").registerToPageChanged(this,b))},stopListen:function(b){this.setState({registeredEvents:a.without(this.state.registeredEvents,b)}),this.props&&b===this.SUPPORTED_SITE_EVENTS.SCROLL&&this.props.siteAPI.getSiteAspect("windowScrollEvent").unregisterToScroll(this,b),this.props&&a.contains(b,this.SUPPORTED_SITE_EVENTS.PAGE_NAVIGATION)&&this.props.siteAPI.getSiteAspect("tpaPageNavigationAspect").unregisterToPageChanged(this)},setSiteMemberDataState:function(a){this.setState({shouldGetSiteMemberDetails:a})},hasOrigComponent:function(){return!a.isUndefined(this.props.compData.origCompId)},setQueryParams:function(b){a.isObject(b)&&this.setState({queryParams:b})}}}),define("tpa/mixins/tpaWidgetMixin",[],function(){"use strict";return{getBaseUrl:function(){var a=this.getAppData(),b=this.props.compData.widgetId,c=a.widgets[b],d=this.isInMobileDevMode();if(this.isUnderMobileView()){var e=c.mobileUrl&&(d||c.mobilePublished);return e?c.mobileUrl:c.widgetUrl}return c.widgetUrl}}}),define("tpa/components/tpaWidget",["lodash","skins","react","core","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaWidgetMixin"],function(a,b,c,d,e,f,g,h){"use strict";var i=d.compFactory,j=d.compMixins,k={displayName:"TPAWidget",mixins:[j.skinBasedComp,e,f,g,h],mutateIframeUrlQueryParam:function(a){return a.width=this.props.style.width,a}};return i.register("wysiwyg.viewer.components.tpapps.TPAWidget",k),k}),define("tpa/mixins/tpaSectionMixin",[],function(){"use strict";return{isTPASection:!0,getSiteAdditionalDataFromProps:function(a){return a.siteData.currentPageInfo.pageAdditionalData||""},mutateSkinProperties:function(a){return"object"==typeof a.iframe&&(a.iframe.src=this.buildUrl(this.getBaseUrl())),a},mutateInitialState:function(a){return a.sectionUrlState=this.getSiteAdditionalDataFromProps(this.props),a.sectionUrl=this.fixSectionUrl(),a},fixSectionUrl:function(){var a=this.props.siteAPI.getPageUrl(!0);return this.endsWith(a,"/")?a:a+="/"},endsWith:function(a,b){return-1!==a.indexOf(b,a.length-b.length)},componentWillReceiveProps:function(a){var b=this.state.sectionUrlState,c=this.getSiteAdditionalDataFromProps(a);if(b!==c&&this.isCompListensTo(this.SUPPORTED_SITE_EVENTS.STATE_CHANGED)&&this.sendPostMessage({intent:"addEventListener",eventType:"STATE_CHANGED",params:{newState:c}}),a.currentPage===this.props.pageId){var d=this.props.siteData.currentPageInfo.pageAdditionalData;this.state.pushState?(d!==b&&d!==this.state.pushState||this.props.currentPage!==a.currentPage)&&this.setState({sectionUrlState:c,sectionUrl:this.fixSectionUrl(),pushState:void 0}):d!==b&&this.setState({sectionUrlState:c,sectionUrl:this.fixSectionUrl()})}},isMobileReady:function(){var a=this.getAppData(),b=this.isInMobileDevMode();return a.sectionMobileUrl&&(b||a.sectionMobilePublished)},mutateIframeUrlQueryParam:function(a){return this.props.siteData.isViewerMode()?(a["section-url"]=this.state.sectionUrl,a.target="_top"):(a["section-url"]=this.getBaseUrl(),a.target="_self"),a.width=this.props.style.width,a},mutateIframeSrc:function(a){return a=this.addStateToUrlObj(a,this.state.sectionUrlState)},addStateToUrlObj:function(a,b){if(b){var c="#"===b.charAt(0);c?a.hash=b:("/"!==a.path.slice(-1)&&(a.path+="/"),a.path+=b)}return a}}}),define("tpa/components/tpaSection",["lodash","skins","react","core","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaSectionMixin"],function(a,b,c,d,e,f,g,h){"use strict";var i=d.compFactory,j=d.compMixins,k={displayName:"TPASection",mixins:[j.skinBasedComp,e,f,g,h],getBaseUrl:function(){var b=this.getAppData(),c=this.props.compData.widgetId,d=b.sectionUrl,e=this.props.compData.type,f=this.isUnderMobileView()&&this.isMobileReady();if("TPAWidget"===e&&c){var g=a.find(b.widgets,function(a){return a.widgetId===c});g&&(d=f?g.mobileUrl:g.widgetUrl)}else f&&(d=b.sectionMobileUrl);return d}};return i.register("wysiwyg.viewer.components.tpapps.TPASection",k),k}),define("tpa/components/tpaMultiSection",["lodash","skins","react","core","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaSectionMixin"],function(a,b,c,d,e,f,g,h){"use strict";var i=d.compFactory,j=d.compMixins,k={displayName:"TPAMultiSection",mixins:[j.skinBasedComp,e,f,g,h],getBaseUrl:function(){var a=this.getAppData(),b=a.sectionUrl,c=a.widgets[this.props.compData.widgetId];return c&&(b=this.isUnderMobileView()&&this.isMobileReady()?c.mobileUrl:c.widgetUrl),b}};return i.register("wysiwyg.viewer.components.tpapps.TPAMultiSection",k),k}),define("tpa/components/tpaWorker",["lodash","skins","core","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin"],function(a,b,c,d,e,f){"use strict";var g=c.compFactory,h=c.compMixins,i={mixins:[h.skinBasedComp,d,e,f],getBaseUrl:function(){var a=this.getAppData();return a.appWorkerUrl},mutateIframeUrlQueryParam:function(a){return a.endpointType="worker",a},mutateSkinProperties:function(a){return a.iframe&&a.iframe.style&&(a.iframe.style.display="none"),a}};g.register("tpa.viewer.classes.TPAWorker",i)}),define("tpa/mixins/tpaResizeWindowMixin",[],function(){"use strict";return{resizeWindow:function(a,b){this.setState({width:a.width,height:a.height},b),this.registerReLayout()}}}),define("tpa/components/tpaGluedWidget",["lodash","skins","react","core","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaWidgetMixin","tpa/mixins/tpaResizeWindowMixin"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=d.compFactory,k=d.compMixins,l={displayName:"TPAGluedWidget",mixins:[k.skinBasedComp,e,f,g,h,i],mutateIframeUrlQueryParam:function(a){return a.width=this.props.style.width,a},mutateSkinProperties:function(a){var b=a[""].style;return b.zIndex=2,this.state&&this.state.width&&(b.width=this.state.width),this.state&&this.state.height&&(b.height=this.state.height),a}};j.register("wysiwyg.viewer.components.tpapps.TPAGluedWidget",l)}),define("tpa/aspects/TPAWorkerAspect",["lodash","core"],function(a,b){"use strict";function e(a){this._aspectSiteAPI=a}var c=function(a){return{componentType:"tpa.viewer.classes.TPAWorker",skin:"wysiwyg.viewer.skins.TPAWidgetSkin",type:"Component",id:a}},d=function(a,d,e){var f="tpaWorker_"+e.applicationId,g=c(f),h=b.componentPropsBuilder.getCompProps(g,a,null,d);return h.compData=e,b.compFactory.getCompClass(g.componentType)(h)};return e.prototype={getComponentStructures:function(){var b=[],d=this._aspectSiteAPI.getSiteData().getClientSpecMap(),e=this.getTPAWorkers(d);if(!a.isEmpty(e)){var f=c();b.push(f)}return b},getTPAWorkers:function(b){var c=a.filter(b,function(b){return a.isString(b.appWorkerUrl)&&b.permissions&&!b.permissions.revoked});return c},getReactComponents:function(b){var c=this._aspectSiteAPI.getSiteData().getClientSpecMap(),e=this._aspectSiteAPI.getSiteAPI(),f=this.getTPAWorkers(c),g=[];return a.forEach(f,function(a){var c=d(e,b,a);g.push(c)}),g}},e}),define("tpa/bi/events",["lodash","utils"],function(a,b){"use strict";var c=b.logger,d={JS_SDK_FUNCTION_CALL:{eventId:12,adapter:"sdk",src:11,params:{visitor_id:"visitorUuid",sdk_ver:"sdkVersion",origin:"origin",function_name:"fnName",namespace:"namespace",app_id:"appId",instance_id:"instanceId",is_published:"isPublished"}},GALLERY_FUNCTION_CALL:{eventId:11,adapter:"sdk",src:11,params:{visitor_id:"visitorUuid",sdk_ver:"sdkVersion",origin:"origin",function_name:"fnName",namespace:"namespace"}}};return c.register("{%= name %}","event",d),d}),define("tpa/bi/tpaBi",["lodash","tpa/utils/tpaUtils","tpa/bi/events","utils"],function(a,b,c,d){"use strict";var e=function(a){return a?c.JS_SDK_FUNCTION_CALL:c.GALLERY_FUNCTION_CALL},f=function(a,b){var c=a.widgets,d=c[b.props.compData.widgetId],e=d?d.published:a.sectionPublished;return e?1:0},g=function(a,c){var d=b.getClientSpecMap(a),e=b.getInstance(a,c.appId);if(!d[c.appId])throw"app definition could not be found by the given appId";var g=a.getComponentById(c.compId);return{appId:d[c.appId].appDefinitionId,instanceId:e.instanceId,isPublished:f(d[c.appId],g)}},h=function(a,b){var c=a.getComponentById(b.compId),d=c&&c.props&&c.props.compData&&c.props.compData.applicationId;return b.appId=d,b.component=c,b},i=function(a){return a.component&&a.component.props.compData&&a.version&&a.type&&a.namespace},j=function(c,f){var j=h(f,c);if(i(j)){var k={visitorUuid:b.getVisitorUuid(d),sdkVersion:j.version,origin:"viewer",fnName:j.type,namespace:j.namespace};if(j.appId){var l=g(f,j);a.merge(k,l)}var m=e(j.appId);f.reportBI(m,k)}};return{sendBIEvent:j}}),define("tpa/common/tpaPostMessageCommon",["tpa/bi/tpaBi"],function(a){"use strict";var b={TPA_MESSAGE:"TPA",TPA_MESSAGE2:"TPA2",TPA_RESPONSE:"TPA_RESPONSE",PINGPONG_PREFIX:"pingpong:"},c=function(a,b,c){var d="";try{d=JSON.stringify(b)}catch(e){return}a.postMessage||(a=a.contentWindow),a.postMessage(d,c||"*")},d=function(a,d){return function(e){try{c(a,{intent:b.TPA_RESPONSE,callId:d.callId,type:d.type,res:e,status:!0})}catch(f){}}},e=function(a){return a===b.TPA_MESSAGE||a===b.TPA_MESSAGE2},f=function(a){return a.replace(b.PINGPONG_PREFIX,"")},g=function(b,c,f,g){var h;try{g.data?h=JSON.parse(g.data):g.originalEvent&&g.originalEvent.data&&(g=g.originalEvent,h=JSON.parse(g.data))}catch(i){return}h&&e(h.intent)&&(b?f(b,c,h,d(g.source,h)):f(c,h,d(g.source,h)),a.sendBIEvent(h,c))};return{Intents:b,callPostMessage:c,generateResponseFunction:d,isTPAMessage:e,fixOldPingPongMessageType:f,handleTPAMessage:g}}),define("tpa/utils/sitePages",["lodash","utils"],function(a,b){"use strict";var c=function(a){var c=b.menuUtils.getSiteMenu(a,!0);return e(c)},d=function(a){var b=c(a);return h(b,a)},e=function(b){var c=[];return a.each(b,function(b){var d=f(b),e=b.items;a.each(e,function(a){var b=f(a);d.subPages=d.subPages||[],d.subPages.push(b)}),c.push(d)}),c},f=function(a){var c=a.link.pageId;return{title:a.label||"",id:b.stringUtils.startsWith(c,"#")?c.substr(1):c,hide:!a.isVisible||!1}},g=function(a,b){return b.getDataByQuery(a,"masterPage")},h=function(b,c){var d=[];return a.each(b,function(b){a.each(b.subPages,function(a){d.push(g(a.id,c))}),d.push(g(b.id,c))}),d};return{getSitePagesInfoData:c,getSitePagesData:d}}),define("tpa/services/pageService",["lodash","tpa/utils/sitePages"],function(a,b){"use strict";var c={},d=function(d){if(a.size(c)>0)return c;var e=b.getSitePagesData(d.getSiteData());return a.each(e,function(b){if(b&&b.tpaApplicationId>0){var d={pageId:b.id,tpaId:b.tpaApplicationId,tpaPageId:b.tpaPageId};a.isUndefined(c[d.tpaId])&&(c[d.tpaId]=[]),c[d.tpaId].push(d)}}),c};return{mapPageToWidgets:d}}),define("tpa/utils/tpaStyleUtils",["lodash","color","fonts","utils"],function(a,b,c,d){"use strict";var e="param_color_",f="param_number_",g="param_boolean_",h="param_font_",i=function(){return{Title:"font_0",Menu:"font_1","Page-title":"font_2","Heading-XL":"font_3","Heading-L":"font_4","Heading-M":"font_5","Heading-S":"font_6","Body-L":"font_7","Body-M":"font_8","Body-S":"font_9","Body-XS":"font_10"}},j=function(a,b){var d=c.fontUtils.parseFontStr(a),e=c.fontUtils.getFontFamilyWithFallbacks(d.family);return{editorKey:b,lineHeight:d.lineHeight,style:d.style,weight:d.weight,size:d.size,fontFamily:d.family.toLowerCase(),value:"font:"+[d.style,d.variant,d.weight,d.size+"/"+d.lineHeight,e].join(" ")+";"}},k=function(a){var c=a.split(",");return b({r:c[0],g:c[1],b:c[2]}).hexString()},l=function(b,c,d){return m(a.extend(n(d,c),w(b)),c)},m=function(b,d){var e={};a.each(b,function(a){"string"==typeof a&&(a=JSON.parse(a)),e[a.family||a.fontFamily]=1});var f=c.fontUtils.getFontsUrl(e,d);return-1!==f.indexOf("family=null")?"":f},n=function(b,c){var d={},e=o(b,c);return a.each(e,function(a,b){b.match(h)&&(d[b.replace(h,"")]=a)},this),d},o=function(a,b){var c=b.getAllTheme(),d=c[a.props.structure.styleId];if(!d)return null;var e=d.style&&d.style.properties;return e?e:null},p=function(c,e,f,g){var i,h=e[c];if(h&&!a.isString(h)&&h.value)return{themeName:void 0,value:h.value.color.value};if(!f&&h&&a.isString(h)&&d.stringUtils.startsWith(h,"color_")){var j=g.getColor(h);j=j.indexOf(",")>-1?k(j):j;var l=b(j);return i=e.hasOwnProperty("alpha-"+c)&&1!==e["alpha-"+c]?"rgba("+l.values.rgb.join(",")+","+e["alpha-"+c]+")":l.hexString(),{themeName:h,value:i}}return f?{themeName:void 0,value:void 0}:{themeName:void 0,value:h}},q=function(a,b,c,i){var j=i.getAllTheme().THEME_DATA,k=d.stringUtils.startsWith(a,"alpha-");if(b.hasOwnProperty(a)&&!k)if(a.match(e))c.colors[a.replace(e,"")]=p(a,b,k,i);else if(a.match(f))c.numbers[a.replace(f,"")]=+b[a];else if(a.match(g)){var l;l=b[a]instanceof Boolean?b[a]:"false"===b[a]?!1:!0,c.booleans[a.replace(g,"")]=l}else if(a.match(h)){var m="object"==typeof b[a]?b[a].value:JSON.parse(b[a]);m.fontStyleParam&&"Custom"===m.preset?r(m):m.fontStyleParam?s(m,j.font):m.fontParam&&t(m),c.fonts[a.replace(h,"")]=m}},r=function(a){var b=c.fontUtils.getFontFamilyWithFallbacks(a.family),d=a.size+"px",e=a.size+(a.size/4<<0)+"px",f=a.style.italic?"italic":"normal",g=a.style.bold?"bold":"normal",h="normal",i="";i+="font:"+[f,h,g,d+"/"+e,b].join(" ")+";",i+=a.style.underline?"text-decoration:underline;":"",a.value=i},s=function(a,b){var c=w(b),d=c[a.preset];a.value=d.value,a.size=parseInt(d.size,10),a.family=d.fontFamily,a.style.bold="bold"===d.weight,a.style.italic="italic"===d.style,a.style.underline=!1},t=function(a){a.family=a.value,a.value=u(a),a.size=0,a.style={bold:!1,italic:!1,underline:!1}},u=function(a){var b="font-family:"+(a.cssFontFamily||a.value)+";";return b=b.replace(/''/g,"'")},v=function(b,c){var d=b.getAllTheme().THEME_DATA,e={colors:{},numbers:{},booleans:{},fonts:{},googleFontsCssUrl:l(d.font,b,c)},f=o(c,b);return f?(a.forEach(f,function(a,c){q(c,f,e,b)}),e):e},w=function(b){var c=0;return a.reduce(i(),function(a,d,e){return a[e]=j(b[c++],d),a},{})},x=function(b){return a.reduce(b,function(a,b,c){return(c>=1&&5>=c||c>=11&&35>=c)&&a.push({name:"color_"+c,value:b.indexOf(",")>-1?k(b):b}),a},[])},y=function(a,b){var d=a.getSiteData(),e=d.getAllTheme().THEME_DATA,f=b&&b.hasOrigComponent()?a.getComponentById(b.getOrigComponentId()):b;return{fonts:{cssUrls:c.fontUtils.getWixStoredFontsCssUrls(d),imageSpriteUrl:d.santaBase+"/static/images/editorUI/fonts.png",fontsMeta:c.fontUtils.getCurrentSelectablefonts(d)},siteTextPresets:w(e.font),siteColors:x(e.color),style:f?v(d,f):{}}};return{getTextPresets:w,getSiteColors:x,getStylesForSDK:v,getStyleDataToPassIntoApp:y}}),define("tpa/handlers/tpaHandlers",["zepto","lodash","react","core","tpa/utils/sitePages","tpa/services/pageService","tpa/utils/tpaUtils","tpa/utils/tpaStyleUtils","fonts"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=d.activityTypes.TPAActivity,k=d.ActivityService,l=function(a,b,c){var d={},e=a.getCurrentPageData();g.sdkVersionIsAtLeast(b.version,"1.42.0")?d.pageTitle=e.siteTitle:(d.siteTitle=e.siteTitle,d.pageTitle=e.title),d.siteDescription=e.descriptionSEO,d.siteKeywords=e.keywordsSEO;var f=a.getSiteData().currentUrl;d.url=f.full,d.baseUrl=f.protocol+"//"+f.host+f.path,d.referer=document.referrer,c(d)},m=function(a,b){var c="number"==typeof b.data?b.data:b.data.height,d=a.getComponentById(b.compId);d.registerReLayout(),d.setState({height:c})},n=function(a,b,c){c(a.getCurrentPageId())},o=function(a,b){a.navigateToPage({pageId:b.data.pageId})},p=function(a,b,c){c(e.getSitePagesInfoData(a.getSiteData()))},q=function(a,c,d){var e=a.getComponentsByPageId(c),f=b.find(e,function(a){return a.isTPASection});f&&f.setState({sectionUrlState:d})},r=function(a,c,d){var e=a.getComponentById(c.compId),g=f.mapPageToWidgets(a),h=e.getAppData(),i=g[h.applicationId];if(b.isUndefined(i))d({error:{message:'Page with app "'+h.appDefinitionName+'" was not found.'}});else{var j,k,l=c.data;if(b.isObject(c.data)&&(l=c.data.state,k=c.data.sectionIdentifier&&c.data.sectionIdentifier.sectionId),b.isUndefined(k))j=i[0].pageId;else{var m=b.find(i,function(a){return a.tpaPageId===k});b.isUndefined(m)?d({error:{message:'App page with sectionId "'+k+'" was not found.'}}):j=m.pageId}q(a,j,l),a.navigateToPage({pageId:j,pageAdditionalData:l})}},s=function(a,b){a.scrollSiteBy(b.data.x,b.data.y)},t=function(a,b){a.scrollSiteTo(b.data.x,b.data.y)},u=function(b,c,d){var e=b.getComponentById(c.compId),f=e.getDOMNode(),g=w(a(f).offset());d({rect:v(f),offsets:g})},v=function(a){var c=a.getBoundingClientRect(),d=b(c).pick(["left","right","top","bottom","height","width"]).mapValues(function(a){return Math.floor(a)}).value();return d},w=function(a){return{x:a.left,y:a.top}},x=function(a,b,c){var d=a.getComponentById(b.compId),e=a.getSiteAspect("tpaModalAspect");e.showModal(B(b,d),c)},y=function(a,b,c){var d=a.getComponentById(b.compId),e=a.getSiteAspect("tpaPopupAspect");e.showPopup(B(b,d),c)},z=function(a,b){var c=a.getComponentById(b.compId);c&&c.hide&&c.hide(b.data)},A=function(a,b,c){var d=a.getComponentById(b.compId);d&&d.resizeWindow&&d.resizeWindow(b.data,c)},B=function(c,d){var e=b.merge(c.data,{origCompId:c.compId});return e.origCompStyle=a(d.getDOMNode()).offset(),e.position=b.defaults(e.position||{},{origin:"FIXED",placement:"CENTER",x:0,y:0}),e.position.x=C(e.position.x),e.position.y=C(e.position.y),e.windowSize={width:a(window).width(),height:a(window).height()},b.merge(e,d.props.compData)},C=function(a){if(b.isString(a)){var c=parseInt(a,10);return b.isNaN(c)?0:c}return b.isNumber(a)?a:0},D=function(a,b){var c=b.data.eventKey,d=a.getComponentById(b.compId);d&&!d.isCompListensTo(c)&&d.startListen(c)},E=function(a,b){var c=b.data.eventKey||b.data,d=a.getComponentById(b.compId);d&&d.stopListen(c)},F=function(a,b){var f,c="string"==typeof b.data?b.data:b.data.state,d=a.getCurrentPageId(),e=a.getComponentById(b.compId);try{switch(f=JSON.parse(c),f.cmd){case"zoom":e.processImageClick(f);break;case"componentReady":e.setComponentInIframeReady();break;case"navigateToAnchor":var g=f.args[0],h=f.args[1];a.getCurrentPageId()===g?h&&a.scrollToAnchor(h):a.navigateToPage({pageId:g,pageAdditionalData:null,anchorData:h});break;default:G(a,e,d,c)}}catch(i){G(a,e,d,c)}},G=function(a,b,c,d){g.isTPASection(b)&&(b.setState({pushState:d}),a.navigateToPage({pageId:c,pageAdditionalData:d}))},H=function(a,c,d){var e=a.getComponentById(c.compId),g=f.mapPageToWidgets(a),h=a.getSiteData().getClientSpecMap()[e.props.compData.applicationId],i=h.applicationId;if(b.isEmpty(g)||b.isUndefined(g[i]))d({error:{message:'Page with app "'+h.appDefinitionName+'" was not found.'}});else{var m,j=g[i],k=c.data.sectionIdentifier,l=b.find(j,{tpaPageId:k})||j[0];if(l&&(m=l.pageId),b.isUndefined(m))d({error:{message:"Page was not found."}});else{var n=a.getPageUrlFor(m);d(b.isUndefined(n)?{error:{message:"Page was not found."}}:{url:n})}}},I=function(a,b,c,d){var e=c.getMemberDetails();null===e?a.setSiteMemberDataState({callback:d}):(d(e),a.setSiteMemberDataState(null))},J=function(a,b,c){var d=a.getComponentById(b.compId),e=a.getSiteAspect("siteMembers"),f=e.isLoggedIn();f?I(d,b,e,function(a){c({authResponse:!0,data:a})}):e.showSignUpDialog(function(a){c({authResponse:!0,data:a})})},K=function(a,b,c){var d=a.getComponentById(b.compId),e=a.getSiteAspect("siteMembers"),f=e.isLoggedIn();f?I(d,b,e,function(a){c(a)}):c(null)},L=function(a,b){var c=b.data,d=a.getComponentById(b.compId),e=a.getSiteData(),f=g.getAppData(a,b.compId),h=f.instance,i={type:c.activity.type||"TPA",appDefinitionId:f.appDefinitionId||"TPA",info:c.activity.info||{},details:c.activity.details||{},instance:h},l=function(a){n({status:!0,response:a})},m=function(a){var b={status:a.status,statusText:a.statusText,responseText:a.responseText};n({status:!1,response:b})},n=function(a){d.sendPostMessage({intent:"TPA_RESPONSE",compId:b.compId,callId:b.callId,type:b.type,status:a.status,res:{response:a.response,status:a.status}})},o=new j(e,i),p=new k(e.currentUrl.host);p.reportActivity(o,l,m)},M=function(a,b,c){c(a.getUserSession())},N=function(a,b,c){var d=a.getComponentById(b.compId);d.setAppIsAlive&&d.setAppIsAlive(),c(O(a,d))},O=function(a,b){var c=a.getSiteData(),d=c.getAllTheme().THEME_DATA,e=b&&b.hasOrigComponent()?a.getComponentById(b.getOrigComponentId()):b;return{fonts:{cssUrls:i.fontUtils.getWixStoredFontsCssUrls(c),imageSpriteUrl:c.santaBase+"/static/images/editorUI/fonts.png",fontsMeta:i.fontUtils.getCurrentSelectablefonts(c)},siteTextPresets:h.getTextPresets(d.font),siteColors:h.getSiteColors(d.color),style:e?h.getStylesForSDK(c,e):{}}},P=function(){};return{siteInfo:l,heightChanged:m,registerEventListener:D,navigateToPage:o,smRequestLogin:J,smCurrentMember:K,scrollBy:s,scrollTo:t,postActivity:L,getCurrentPageId:n,getUserSession:M,boundingRectAndOffsets:u,navigateToSectionPage:r,getSitePages:p,removeEventListener:E,appIsAlive:N,openModal:x,openPopup:y,closeWindow:z,resizeWindow:A,appStateChanged:F,getSectionUrl:H,getStyleDataToPassIntoApp:O,tpaWorker:{siteInfo:l,getSitePages:p,removeEventListener:E,registerEventListener:D,smCurrentMember:K,appIsAlive:N,navigateToSectionPage:r,getViewMode:P,getDeviceType:P,getLocale:P,getInstanceId:P,getIpAndPort:P},toWixDate:P,getViewMode:P,getCompId:P,getOrigCompId:P,getWidth:P,getLocale:P,getCacheKiller:P,getTarget:P,getInstanceId:P,getSignDate:P,getUid:P,getPermissions:P,getIpAndPort:P,getDemoMode:P,getDeviceType:P,getImageUrl:P,getResizedImageUrl:P,getAudioUrl:P,getDocumentUrl:P,getSwfUrl:P}}),define("tpa/handlers/tpaPubSubHandlers",["tpa/utils/tpaUtils"],function(a){"use strict";return{registerEventListener:function(a,b){a.getSiteAspect("tpaPubSubAspect").subscribe(b)},publish:function(b,c){var d=c.data,e=c.compId,f=a.getAppDefId(b,e);d.eventKey=a.stripPubSubPrefix(d.eventKey),b.getSiteAspect("tpaPubSubAspect").publish(f,e,d)},removeEventListener:function(b,c){var d=c.compId,e=c.data,f=a.getAppDefId(b,d),g=a.stripPubSubPrefix(e.eventKey);b.getSiteAspect("tpaPubSubAspect").unsubscribe(f,d,g)}}}),define("tpa/aspects/TPAPostMessageAspect",["lodash","tpa/common/tpaPostMessageCommon","tpa/handlers/tpaHandlers","tpa/handlers/tpaPubSubHandlers","tpa/utils/tpaUtils","utils"],function(a,b,c,d,e,f){"use strict";var g=function(b){return a.has(b,"data")&&!a.isNull(b.data)?b.data.eventKey&&f.stringUtils.startsWith(b.data.eventKey,e.Constants.TPA_PUB_SUB_PREFIX):void 0},h=function(a){return g(a)?d:j(a.compId)?c.tpaWorker:c},i=function(a,c,d){if(k(a,c.compId,c.type)){var e=b.fixOldPingPongMessageType(c.type),f=h(c);
if(!f[e])throw new Error('Could not find handler for: "'+c.type+'" type');f[e].apply(this,[a,c,d])}},j=function(a){return a&&f.stringUtils.startsWith(a,"tpaWorker_")},k=function(a,b,c){var d=a.getComponentById(b);if("masterPage"===d.props.pageId||"appStateChanged"!==c)return!0;var e=a.getCurrentPageId();return d.props.pageId===e},l=function(a){a.registerToMessage(this.handleTPAMessage.bind(this)),this._siteAPI=a};return l.prototype={handleTPAMessage:function(a){b.handleTPAMessage.call(this,void 0,this._siteAPI,i,a)},sendPostMessage:function(a,c){var d=a.getIframe();if(!d)throw new Error("No iframe found in TPA component",a);b.callPostMessage(d,c)},callHandler:i},l}),define("tpa/mixins/tpaRuntimeCompMixin",[],function(){"use strict";return{getOrigComponentId:function(){return this.props.compData.origCompId}}}),define("tpa/components/tpaPopup",["lodash","zepto","skins","react","core","utils","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaRuntimeCompMixin"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=e.compFactory,k=e.compMixins,l={FIXED:"FIXED",ABSOLUTE:"ABSOLUTE",RELATIVE:"RELATIVE"},m={bottomCenter:"BOTTOM_CENTER",bottomLeft:"BOTTOM_LEFT",bottomRight:"BOTTOM_RIGHT",center:"CENTER",centerLeft:"CENTER_LEFT",centerRight:"CENTER_RIGHT",topCenter:"TOP_CENTER",topLeft:"TOP_LEFT",topRight:"TOP_RIGHT"},n=function(a,b,c){return a+b/2-c/2},o=function(a,b,c){return a-(b+c)},p=function(a,b,c){return a-(b+c)},q=function(a,b,c){return a+b/2-c/2},r=function(b){function c(a){return/(%)$/.exec(a)}function d(a){return/^([0-9]+)/.exec(a)}var e=0,f="";if(a.isNumber(b))e=b;else if(a.isString(b)){var g=c(b),h=d(b);e=h&&h[1]?parseInt(h[1],10):0,g&&g[1]&&(f=g[1])}return{size:e,unit:f}},s=function(b,c,d,e){var f={position:"fixed",display:"block",width:d,height:e};return e=r(e),e.size=a.min("%"===e.unit?[e.size,100]:[e.size,c.height]),d=r(d),d.size=a.min("%"===d.unit?[d.size,100]:[d.size,c.width]),b.placement===m.center?a.extend(f,{height:e.size+e.unit,width:d.size+d.unit,marginLeft:d.size/-2+d.unit,marginTop:"%"===e.unit?0:e.size/-2+e.unit,left:"50%",top:"%"===e.unit?0:"50%"}):b.placement===m.topLeft?a.extend(f,{height:e.size+e.unit,width:d.size+d.unit,left:"0px",top:"0px"}):b.placement===m.topRight?a.extend(f,{height:e.size+e.unit,width:d.size+d.unit,right:"0px",top:"0px"}):b.placement===m.topCenter?a.extend(f,{height:e.size+e.unit,width:d.size+d.unit,marginLeft:d.size/-2+d.unit,top:"0px",left:"50%"}):b.placement===m.centerRight?a.extend(f,{height:e.size+e.unit,width:d.size+d.unit,marginTop:"%"===e.unit?0:e.size/-2+e.unit,top:"%"===e.unit?0:"50%",right:"0px"}):b.placement===m.centerLeft?a.extend(f,{height:e.size+e.unit,width:d.size+d.unit,marginTop:"%"===e.unit?0:e.size/-2+e.unit,top:"%"===e.unit?0:"50%",left:"0px"}):b.placement===m.bottomLeft?a.extend(f,{height:e.size+e.unit,width:d.size+d.unit,bottom:"0px",left:"0px"}):b.placement===m.bottomRight?a.extend(f,{height:e.size+e.unit,width:d.size+d.unit,bottom:"0px",right:"0px"}):b.placement===m.bottomCenter?a.extend(f,{height:e.size+e.unit,width:d.size+d.unit,marginLeft:d.size/-2+d.unit,left:"50%",bottom:"0px"}):f},t=function(b,c,d,e,f){var h,i,g={position:"absolute",display:"block"};return b.placement===m.center?(e=a.min([e,d.height]),f=a.min([f,d.width]),h=q(c.top,c.height,e),i=n(c.left,c.width,f)):b.placement===m.topLeft?(e=a.min([e,c.top]),f=a.min([f,c.left]),h=c.top-e,i=c.left-f):b.placement===m.topRight?(e=a.min([e,c.top]),f=a.min([f,p(d.width,c.width,c.left)]),h=c.top-e,i=c.width+c.left):b.placement===m.topCenter?(e=a.min([e,c.top]),f=a.min([f,d.width]),h=c.top-e,i=n(c.left,c.width,f)):b.placement===m.centerRight?(e=a.min([e,d.height]),f=a.min([f,p(d.width,c.width,c.left)]),h=q(c.top,c.height,e),i=c.width+c.left):b.placement===m.centerLeft?(e=a.min([e,d.height]),f=a.min([f,c.left]),h=q(c.top,c.height,e),i=c.left-f):b.placement===m.bottomLeft?(e=a.min([e,o(d.height,c.top,c.height)]),f=a.min([f,c.left]),h=c.top+c.height,i=c.left-f):b.placement===m.bottomRight?(e=a.min([e,o(d.height,c.top,c.height)]),f=a.min([f,p(d.width,c.width,c.left)]),h=c.top+c.height,i=c.width+c.left):b.placement===m.bottomCenter&&(e=a.min([e,o(d.height,c.top,c.height)]),f=a.min([f,d.width]),h=c.top+c.height,i=n(c.left,c.width,f)),h=a.max([0,h]),i=a.max([0,i]),a.extend(g,{top:h,left:i,width:f,height:e})},u=function(b,c,d,e,f){var h,i,j,k,g={position:"absolute",display:"block"};return b.placement===m.center?(j=a.min([c.top+b.y,d.height-(c.top+b.y)]),e=a.min([e,2*j]),k=a.min([c.left+b.x,d.width-(c.left+b.x)]),f=a.min([f,2*k]),h=c.top+b.y-e/2,i=c.left+b.x-f/2):b.placement===m.topLeft?(e=a.min([e,c.top+b.y]),f=a.min([f,c.left+b.x]),h=c.top+b.y-e,i=c.left+b.x-f):b.placement===m.topRight?(e=a.min([e,c.top+b.y]),f=a.min([f,d.width-(c.left+b.x)]),h=c.top+b.y-e,i=c.left+b.x):b.placement===m.topCenter?(e=a.min([e,c.top+b.y]),k=a.min([c.left+b.x,d.width-(c.left+b.x)]),f=a.min([f,2*k]),h=c.top+b.y-e,i=c.left+b.x-f/2):b.placement===m.centerRight?(j=a.min([c.top+b.y,d.height-(c.top+b.y)]),e=a.min([e,2*j]),f=a.min([f,d.width-(c.left+b.x)]),h=c.top+b.y-e/2,i=c.left+b.x):b.placement===m.centerLeft?(j=a.min([c.top+b.y,d.height-(c.top+b.y)]),e=a.min([e,2*j]),f=a.min([f,c.left+b.x]),h=c.top+b.y-e/2,i=c.left+b.x-f):b.placement===m.bottomLeft?(e=a.min([e,d.height-(c.top+b.y)]),f=a.min([f,c.left+b.x]),h=c.top+b.y,i=c.left+b.x-f):b.placement===m.bottomRight?(e=a.min([e,d.height-(c.top+b.y)]),f=a.min([f,d.width-(c.left+b.x)]),h=c.top+b.y,i=c.left+b.x):b.placement===m.bottomCenter&&(e=a.min([e,d.height-(c.top+b.y)]),k=a.min([c.left+b.x,d.width-(c.left+b.x)]),f=a.min([f,2*k]),h=c.top+b.y,i=c.left+b.x-f/2),h=a.max([0,h]),i=a.max([0,i]),a.extend(g,{top:h,left:i,width:f,height:e})},v=function(b,c,d,e){var f=10;if(e.width<f||e.height<f){var g=r(d);g.size=a.min("%"===g.unit?[g.size,100]:[g.size,b.height]);var h=r(c);return h.size=a.min("%"===h.unit?[h.size,100]:[h.size,b.width]),{position:"fixed",display:"block",width:h.size+g.unit,height:g.size+h.unit,marginLeft:h.size/-2+g.unit,marginTop:g.size/-2+h.unit,left:"50%",top:"50%"}}return e},w=function(a,b,c,d,e){var f={};return a.origin===l.FIXED&&(f=s(a,c,d,e)),a.origin===l.RELATIVE&&(f=t(a,b,c,e,d)),a.origin===l.ABSOLUTE&&(f=u(a,b,c,e,d)),f=v(c,d,e,f)},x={displayName:"TPAPopup",mixins:[k.skinBasedComp,g,h,i],getInitialState:function(){return{showComponent:!0,registeredEvents:[]}},getSkinProperties:function(){var a=this.state.showComponent?this.getSelfStyle():{display:"none"},b=this.isBareTheme()?"none":"block";return this.state.showComponent?{"":{style:a},closeButton:{onClick:this.hide,style:{display:b}},iframe:{src:this.buildUrl(this.props.compData.url),scrolling:"no",frameBorder:"0",allowTransparency:!0,allowFullScreen:!0}}:{"":{style:a}}},mutateIframeUrlQueryParam:function(a){return a.origCompId=this.props.compData.origCompId,a},getSelfStyle:function(){var b=a.defaults(this.props.compData.position,{x:0,y:0}),c=this.props.compData.origCompStyle,d=this.props.compData.windowSize,e=a.isUndefined(this.state.width)?this.props.compData.width:this.state.width,f=a.isUndefined(this.state.height)?this.props.compData.height:this.state.height,g=w(b,c,d,e,f);return this.getThemeStyle(g)},getThemeStyle:function(b){return this.isBareTheme()?a.merge(b,{background:"none",boxShadow:"none",borderRadius:0}):b},hide:function(b,c){var d=this;e.compFactory.invalidate("wysiwyg.viewer.components.tpapps.TPAPopup"),this.setState({showComponent:!1},function(){d.props.onCloseCallback&&d.props.onCloseCallback(b),this.props.siteAPI.getSiteAspect("tpaPopupAspect").removePopup(d),a.isFunction(c)&&c()})},isBareTheme:function(){return"BARE"===this.props.compData.theme},resizeWindow:function(a,b){this.setState({width:a.width,height:a.height},b)}};return j.register("wysiwyg.viewer.components.tpapps.TPAPopup",x),x}),define("tpa/aspects/TPAPopupAspect",["lodash","core","utils","tpa/components/tpaPopup"],function(a,b,c){"use strict";function e(){return{componentType:"wysiwyg.viewer.components.tpapps.TPAPopup",type:"Component",id:c.guidUtils.getUniqueId(),skin:"wysiwyg.viewer.skins.TPAPopupSkin",styleId:""}}function f(a,c,d,e,f){var g=b.componentPropsBuilder.getCompProps(a,c,null,d);return g.compData=e,g.onCloseCallback=f,b.compFactory.getCompClass(a.componentType)(g)}function g(a){this.aspectSiteApi=a,this.shouldShowPopup=!1,this.tpaPopup=[],this.aspectSiteApi.registerToPageChange(this.removeAllPopups.bind(this))}return g.prototype={getComponentStructures:function(){return this.shouldShowPopup?[e()]:null},getReactComponents:function(a){var b;if(this.shouldShowPopup){if(this.shouldShowNewPopup){this.shouldShowNewPopup=!1;var c=e();b=f(c,this.aspectSiteApi.getSiteAPI(),a,this.popupData,this.popupOnClose),this.tpaPopup.push(b)}return this.tpaPopup}return null},showPopup:function(a,b){this.shouldShowPopup=!0,this.shouldShowNewPopup=!0,this.popupData=a,this.popupOnClose=b,this.aspectSiteApi.forceUpdate()},removePopup:function(b){var c=b.props.id,d=this.tpaPopup;this.tpaPopup=a.reject(d,function(a){return a.props.id===c})},removeAllPopups:function(){a.isEmpty(this.tpaPopup)||(this.tpaPopup=[],this.shouldShowPopup=!1,this.aspectSiteApi.forceUpdate())}},g}),define("tpa/classes/PubSubHub",["lodash"],function(a){"use strict";var b=function(a){this.hub=a||{}};return b.prototype={persistData:function(a,b,c,d){var e={data:d,name:b,origin:c},f=this._addEvent(a,b);f.data.push(e)},addEventListener:function(b,c,d){var e=this._addEvent(b,c);a.contains(e.listeners,d)||e.listeners.push(d)},removeEventListener:function(b,c,d){var e=this._getEvent(b,c);e&&(e.listeners=a.without(e.listeners,d))},getPersistedData:function(a,b){var c=this._getEvent(a,b);return c&&c.data},getEventListeners:function(a,b){var c=this._getEvent(a,b);return c&&c.listeners},_addEvent:function(a,b){var c=this.hub[a];c||(c=this.hub[a]={});var d=c[b];return d||(d=c[b]={data:[],listeners:[]}),d},_getEvent:function(a,b){var c=this.hub[a];return c?c[b]:void 0}},b}),define("tpa/aspects/TPAPubSubAspect",["lodash","tpa/utils/tpaUtils","tpa/classes/PubSubHub"],function(a,b,c){"use strict";var d=function(a){this.aspectSiteAPI=a,this.hub=new c};return d.prototype={publish:function(c,d,e){var f=e.eventKey,g=e.isPersistent,h=this.hub.getEventListeners(c,f),i={eventType:b.addPubSubEventPrefix(f),intent:"addEventListener",params:{data:e.eventData,name:f,origin:d}};if(a.forEach(h,function(a){this._sendDataToComp(a,i)}.bind(this)),g){var j=e.eventData;this.hub.persistData(c,f,d,j)}},subscribe:function(c){var d=c.compId,e=c.data,f=b.stripPubSubPrefix(e.eventKey),g=e.receivePastEvents,h=b.getAppDefId(this.aspectSiteAPI,d);if(this.hub.addEventListener(h,f,d),g){var i=this.hub.getPersistedData(h,f);if(!a.isEmpty(i)){var j={intent:"TPA_RESPONSE",compId:d,callId:c.callId,type:c.type,status:!0,res:{drain:!0,data:i}};this._sendDataToComp(d,j)}}},unsubscribe:function(a,b,c){var d=this.hub.getEventListeners(a,c);d&&this.hub.removeEventListener(a,c,b)},_sendDataToComp:function(a,b){var c=this.aspectSiteAPI.getComponentById(a);c&&c.sendPostMessage(b)}},d}),define("tpa/aspects/TPAPixelTrackerAspect",["lodash","utils"],function(a,b){"use strict";function e(a){new Image(0,0).src=a}function f(b,e){var f=e.map(function(d){return a.assign(d.query,{page:b(),ck:c.cacheKiller()}),delete d.search,c.buildFullUrl(d)});d(f,h.sendRequest,h.CHUNK_SIZE,h.CHUNK_INTERVAL)}function g(b){return a(b).filter("pixelUrl").filter("installedAtDashboard").map(function(b){var d=c.parseUrl(b.pixelUrl);return a.assign(d.query,{instance:b.instance}),d}).value()}function h(a){var b=a.getSiteData().getClientSpecMap(),c=g(b),d=a.getPageUrl.bind(a),e=f.bind(null,d,c);a.registerToComponentDidMount(e),a.registerToPageChange(e)}var c=b.urlUtils,d=b.throttleUtils.throttledForEach;return h.sendRequest=e,h.CHUNK_SIZE=1,h.CHUNK_INTERVAL=100,h}),define("tpa/aspects/TPAPageNavigationAspect",["lodash"],function(a){"use strict";var b=function(a,b,c,d){return"PAGE_NAVIGATION"===a.type||"PAGE_NAVIGATION_IN"===a.type&&d===b||"PAGE_NAVIGATION_OUT"===a.type&&d===c},c=function(a,b){this._listeners={},this._siteAPI=a,this._currentPageId=b||this._siteAPI.getCurrentPageId(),this._siteAPI.registerToPageChange(this.notifyPageChanged.bind(this))};return c.prototype={notifyPageChanged:function(){var c=this._siteAPI.getCurrentPageId(),d=this._currentPageId;a.forEach(this._listeners,function(e){a.forEach(e,function(a){var e=a.comp.props.pageId,f=a.comp.isMounted();f&&b(a,c,d,e)&&a.comp.sendPostMessage({intent:"addEventListener",eventType:a.type,params:{toPage:c,fromPage:d,isAppOnPage:e===c,wasAppOnPage:e===d}})})}),this._currentPageId=c},registerToPageChanged:function(a,b){var c=this._listeners[a.props.id];c||(c=this._listeners[a.props.id]=[]),c.push({comp:a,type:b})},unregisterToPageChanged:function(a){delete this._listeners[a.props.id]}},c}),define("tpa/components/tpaModal",["lodash","zepto","skins","react","core","utils","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaRuntimeCompMixin"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=e.compFactory,k=e.compMixins,l={displayName:"TPAModal",mixins:[k.skinBasedComp,g,h,i],getInitialState:function(){return this.props.siteAPI.getSiteAspect("windowResizeEvent").registerToResize(this),{showComponent:!0,registeredEvents:[],$displayDevice:this.getDeviceType(),windowSize:this.props.compData.windowSize}},getSkinProperties:function(){var a=this;"mobile"===this.state.$displayDevice&&this.props.siteAPI.enterFullScreenMode();var b=this.state.showComponent?{position:"fixed",display:"block"}:{display:"none"},c=this.isBareTheme()?"none":"block";return this.state.showComponent?{"":{style:b},blockingLayer:{onClick:function(b){a.hide({},b)}},frameWrap:{style:this.isBareTheme()?{background:"transparent",border:"none"}:this.getIframeWrapperStyle()},dialog:{style:this.getDialogStyle()},xButton:{children:"Ã—",onClick:this.hide,style:{display:c}},iframe:{src:this.buildUrl(this.props.compData.url),frameBorder:"0",allowTransparency:!0,allowFullScreen:!0}}:{"":{style:b}}},getIframeWrapperStyle:function(){var a=this.props.siteData.isMobileView(),b={};return a&&(b={WebkitOverflowScrolling:"touch",overflowY:"scroll"}),b},getDialogStyle:function(){if("mobile"===this.getDeviceType())return{};var b=this.state.windowSize,c=a.isNumber(this.state.width)?this.state.width:this.props.compData.width,d=a.isNumber(this.state.height)?this.state.height:this.props.compData.height;return c=Math.min(c,b.width),d=Math.min(d,b.height),{width:c,height:d,marginTop:-d/2,marginLeft:-c/2}},mutateIframeUrlQueryParam:function(a){return a.origCompId=this.props.compData.origCompId,a},hide:function(b,c){e.compFactory.invalidate("wysiwyg.viewer.components.tpapps.TPAModal");var d=this;this.setState({showComponent:!1},function(){var e=b&&b.message?b:void 0;d.props.onCloseCallback&&d.props.onCloseCallback(e),"mobile"===d.state.$displayDevice&&d.props.siteAPI.exitFullScreenMode(),d.props.siteAPI.getSiteAspect("windowResizeEvent").unregisterToResize(d),d.props.siteAPI.getSiteAspect("tpaModalAspect").removeModal(d),a.isFunction(c)&&c()})},isBareTheme:function(){return"BARE"===this.props.compData.theme},resizeWindow:function(a,b){this.setState({width:a.width,height:a.height},b)},onResize:function(){this.setState({windowSize:{width:b(window).width(),height:b(window).height()}})}};return j.register("wysiwyg.viewer.components.tpapps.TPAModal",l),l}),define("tpa/aspects/TPAModalAspect",["lodash","core","utils","tpa/components/tpaModal"],function(a,b,c){"use strict";function e(){return{componentType:"wysiwyg.viewer.components.tpapps.TPAModal",type:"Component",id:c.guidUtils.getUniqueId(),skin:"wysiwyg.viewer.skins.TPAModalSkin"}}function f(a,c,d,e,f){var g=b.componentPropsBuilder.getCompProps(a,c,null,d);return g.compData=e,g.onCloseCallback=f,g.key=a.id,b.compFactory.getCompClass(a.componentType)(g)}function g(a){this.aspectSiteApi=a,this.modalStructure=null}return g.prototype={getComponentStructures:function(){return this.modalStructure?[this.modalStructure]:null},getReactComponents:function(a){return this.modalStructure?[f(this.modalStructure,this.aspectSiteApi.getSiteAPI(),a,this.modalData,this.modalOnClose)]:null},showModal:function(a,b){this.modalStructure=e(),this.modalData=a,this.modalOnClose=b,this.aspectSiteApi.forceUpdate()},removeModal:function(){this.modalStructure=null}},g}),define("tpa/aspects/tpaAspectCollector",["core","tpa/aspects/TPAWorkerAspect","tpa/aspects/TPAPostMessageAspect","tpa/aspects/TPAPopupAspect","tpa/aspects/TPAPubSubAspect","tpa/aspects/TPAPixelTrackerAspect","tpa/aspects/TPAPageNavigationAspect","tpa/aspects/TPAModalAspect"],function(a){"use strict";var b=a.siteAspectsRegistry;b.registerSiteAspect("tpaWorkerAspect",arguments[1]),b.registerSiteAspect("tpaPostMessageAspect",arguments[2]),b.registerSiteAspect("tpaPopupAspect",arguments[3]),b.registerSiteAspect("tpaPubSubAspect",arguments[4]),b.registerSiteAspect("tpaPixelTrackerAspect",arguments[5]),b.registerSiteAspect("tpaPageNavigationAspect",arguments[6]),b.registerSiteAspect("tpaModalAspect",arguments[7])}),define("tpa/layout/gluedWidgetPatcher",["lodash","zepto"],function(a,b){"use strict";function e(a,b,c,d){var e=d.isMobileView()?"mobileAd":"desktopTopAd",f=a+e,g=c[a].querySelector("#"+f);g&&(b.custom[a]={topAd:g.getBoundingClientRect()})}function f(a){return"number"==typeof a?a:a?parseFloat(a)||0:0}function g(a){return"undefined"!=typeof a}function h(a,b,c,d,e){return{top:g(a.top)?a.top:e-c,bottom:g(a.bottom)?e-a.bottom:a.top+c,right:g(a.right)?d-a.right:a.left+b,left:g(a.left)?a.left:d-b}}function i(a,b){return!(a.right<b.left||a.left>b.right||a.bottom<b.top||a.top>b.bottom)}function j(a,b,c){return i(c,b)&&(a.top=(a.top||0)+(c.bottom-b.top)),a}function k(b,e,g,i,k,l,m,n,o){function r(){if(n>=-1&&1>=n){var a=i/2-e/2,b=i-2*d,c=b/2-e/2,f=n*c;p.top=a+f}else-1>n?(q=2+n,p.top=q*d):n>1&&(q=2-n,p.bottom=k+q*d)}function s(){if(o>=-1&&1>=o){var a=g/2-b/2,d=g-2*c,e=d/2-b/2,f=o*e;p.left=a+f}else o>1?(q=2-o,p.right=q*c):-1>o&&(q=2+o,p.left=q*c)}n=f(n),o=f(o),i-=k;var q,p={};switch(m){case"TOP_LEFT":p.top=0,p.left=0;break;case"TOP_RIGHT":p.top=0,p.right=0;break;case"BOTTOM_RIGHT":default:p.bottom=k,p.right=0;break;case"BOTTOM_LEFT":p.bottom=k,p.left=0;break;case"CENTER_RIGHT":p.right=0,r();break;case"CENTER_LEFT":p.left=0,r();break;case"BOTTOM_CENTER":p.bottom=k,s();break;case"TOP_CENTER":p.top=0,s()}if(l){var t=h(p,b,e,g,i);p=j(p,t,l)}return a.defaults(p,{position:"fixed",top:"",left:"",right:"",bottom:"",marginLeft:"",marginTop:""})}function l(a,c,d,e,f,g){var h=f.propertiesItem,i=h.placement||a(f.dataItem,g),j=h.horizontalMargin,l=h.verticalMargin,m=e.height[c],n=e.width[c],o=e.siteMarginBottom,p=e.height.screen,q=e.width.screen,r=e.custom&&e.custom[g.WIX_ADS_ID]&&e.custom[g.WIX_ADS_ID].topAd,s=k(n,m,q,p,o,r,i,l,j);b(d[c]).css(s)}function m(a){function b(b,c){try{return a.getDefaultPlacement(b,c)}catch(d){return""}}this.getCssPositioningAttributes=k,this.measureWixAdComponent=e,this.patchGluedWidget=l.bind(this,b)}var c=300,d=120;return m}),define("tpa/layout/tpaSectionPatcher",["zepto"],function(a){"use strict";return{patchTPASection:function(b,c,d,e,f){var g=d.height[b],h=d.width[b],i=c[b+"iframe"],j=f.os.ios&&f.browser.safari;j&&i&&a(i).css({width:h,height:g})}}}),define("tpa/layout/tpaPatcher",["zepto"],function(a){"use strict";return{measureTPA:function(b,c,d){var e=parseInt(a(d[b]).attr("data-min-height"),10);e&&(c.minHeight[b]=e,c.height[b]=e)}}}),define("tpa/layout/tpaGluedWidgetPlacement",[],function(){"use strict";function a(a,b){var c=a.applicationId,d=a.widgetId,e=b.rendererModel.clientSpecMap,f=e[c],g=f.widgets[d],h=g.gluedOptions;return h.placement}return{getDefaultPlacement:a}}),define("tpa/layout/tpaLayout",["layout","tpa/layout/gluedWidgetPatcher","tpa/layout/tpaSectionPatcher","tpa/layout/tpaPatcher","tpa/layout/tpaGluedWidgetPlacement"],function(a,b,c,d,e){"use strict";var f=new b(e);return a.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPAWidget",d.measureTPA),a.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPASection",d.measureTPA),a.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPAMultiSection",d.measureTPA),a.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPAGluedWidget",d.measureTPA),a.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPAWidget"),a.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPAGluedWidget"),a.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPASection"),a.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPAMultiSection"),a.registerRequestToMeasureChildren("wysiwyg.viewer.components.tpapps.TPASection",[["iframe"]]),a.registerRequestToMeasureChildren("wysiwyg.viewer.components.tpapps.TPAMultiSection",[["iframe"]]),a.registerPatcher("wysiwyg.viewer.components.tpapps.TPAGluedWidget",f.patchGluedWidget),a.registerPatcher("wysiwyg.viewer.components.tpapps.TPASection",c.patchTPASection),a.registerPatcher("wysiwyg.viewer.components.tpapps.TPAMultiSection",c.patchTPASection),["wysiwyg.viewer.components.WixAdsMobile","wysiwyg.viewer.components.WixAdsDesktop"].forEach(function(b){a.registerRequestToMeasureChildren(b,[["desktopTopAd"],["mobileAd"]]),a.registerCustomMeasure(b,f.measureWixAdComponent)}),{}}),define("tpa/components/tpaPreloaderOverlay",["lodash","skins","react","core"],function(a,b,c,d){"use strict";var e=d.compFactory,f=d.compMixins,g={mixins:[f.skinBasedComp],getSkinProperties:function(){return{content:{style:{backgroundImage:"url("+this.props.siteData.santaBase+"/static/images/tpaPreloader/Loader_29px.gif)"}}}}};e.register("wysiwyg.viewer.components.tpapps.TPAPreloaderOverlay",g)}),define("tpa/components/tpaUnavailableMessageOverlay",["lodash","skins","react","core"],function(a,b,c,d){"use strict";var e=d.compFactory,f=d.compMixins,g={mixins:[f.skinBasedComp],transformRefData:a.noop,getInitialState:function(){return{showOverlay:!0}},getSkinProperties:function(){var a={text:{children:[this.props.compData.text]},dismissButton:{onClick:this.props.compData.hideOverlayFunc}};return this.transformRefData(a),a}};e.register("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay",g)}),define("tpa",["tpa/components/tpaWidget","tpa/components/tpaSection","tpa/components/tpaMultiSection","tpa/components/tpaWorker","tpa/components/tpaGluedWidget","tpa/aspects/tpaAspectCollector","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/layout/tpaLayout","tpa/components/tpaPreloaderOverlay","tpa/components/tpaUnavailableMessageOverlay","tpa/layout/gluedWidgetPatcher","tpa/layout/tpaPatcher","tpa/layout/tpaSectionPatcher","tpa/mixins/tpaCompBaseMixin","tpa/common/tpaPostMessageCommon","tpa/handlers/tpaHandlers","tpa/common/TPAUrlBuilder","tpa/utils/tpaStyleUtils"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";return{widget:a,section:b,multiSection:c,worker:d,gluedWidget:e,tpaMixins:{tpaUrlBuilder:g,tpaCompApi:h,tpaCompBase:o},GluedWidgetPatcher:l,tpaPatcher:m,tpaSectionPatcher:n,tpaHandlers:q,common:{tpaPostMessageCommon:p,TPAUrlBuilder:r,styleUtils:s}}});